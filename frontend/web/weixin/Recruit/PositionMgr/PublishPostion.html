<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<META HTTP-EQUIV="Pragma" CONTENT="no-cache"> 
		<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache"> 
		<META HTTP-EQUIV="Expires" CONTENT="0"> 
		<script type="text/javascript" src="http://www.zmzfang.com/weixin/js/head.js"></script>
    	<title>芝麻找房</title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/style.css?v=0.02" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.css" />
        <link rel="stylesheet" type="text/css" href="../../css/mui.poppicker.css" />
	
		<style type="text/css">
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">发布职位</h1>
		
		</header>


		<div class="mui-content">
			<section id='requirement-info' class="requirement-info">
				<ul id="addressInfoList" class="mui-table-view">
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>职位</label>
							<select id="position" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='业务员'>业务员</option>
								<option value='置业顾问'>置业顾问</option>
								<option value='客户经理'>客户经理</option>
								<option value='店长'>店长</option>
								<option value='案场销售'>案场销售</option>
								<option value='客户主任'>客户主任</option>
								<option value='销售总监'>销售总监</option>
								<option value='行政管理'>行政管理</option>
								<option value='房产评估师'>房产评估师</option>
								<option value='客服'>客服</option>
								<option value='其他房产职位'>其他房产职位</option>
							</select>
						</div>
					</li>
					
					<li class="mui-table-view-cell">
						<div id="cityDiv" class="mui-input-row">
							<label>工作城市</label>
							<button id='showCityPicker' class="mui-btn mui-btn-block" type='button' style="margin-bottom: 10px;padding:10px 5px;float: left;width: 60%">请选择城市</button>
						</div>
					</li>
					
			
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>具体地址</label>
							<input id="location" type="text" placeholder="">
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>招聘人数</label>
							<select id="recruitcount" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='1-5人'>1-5人</option>
								<option value='5-10人'>5-10人</option>
								<option value='10-20人'>10-20人</option>
								<option value='20-30人'>20-30人</option>
								<option value='30人以上'>30人以上</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>有效期</label>
							<select id="expiretime" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value=1>1个月</option>
								<option value=2>2个月</option>
								<option value=3>3个月</option>
								<option value=4>4个月</option>
								<option value=5>5个月</option>
								<option value=6>6个月</option>
								<option value=12>1年</option>
								<option value=360>常年有效</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>工作年限</label>
							<select id="workingExperience" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='不限'>不限</option>
								<option value='1-3'>1-3年</option>
								<option value='3-5'>3-5年</option>
								<option value='5-8'>5-8年</option>
								<option value='8-30'>8年以上</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>学历要求</label>
							<select id="education" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='不限'>不限</option>
								<option value='中专'>中专</option>
								<option value='高中'>高中</option>
								<option value='大专'>大专</option>
								<option value='本科'>本科</option>
								<option value='研究生及以上'>研究生及以上</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>薪酬</label>
							<select id="salary" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='0-3000'>3k以下</option>
								<option value='3000-5000'>3k-5k</option>
								<option value='5000-8000'>5k-8k</option>
								<option value='8000-10000'>8k-10k</option>
								<option value='10000-15000'>10k-15k</option>
								<option value='15000-20000'>15k-20k</option>
								<option value='20000-25000'>20k以上</option>
								<option value='面议'>面议</option>
							</select>
						</div>
					</li>
				
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>职位描述</label>
							<textarea id="position_des" rows="5" placeholder="" ></textarea>
						</div>
					</li>
				
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>公司介绍</label>
							<textarea id="company_des" rows="3" placeholder="" ></textarea>
						</div>
					</li>
					
				</ul>
				<div id='publishPosition' class="submit-btn btn-green">发布</div>
				
			</section>
	
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/jquery.min.js"></script>
		<script src="../../js/common.js"></script>
		<script src="../../js/ajax.js"></script>
		<script src="../../js/area.js"></script>
		<script src="../../js/city.data.js"></script>
		<script src="../../js/mui.picker.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/commonAjax.js"></script>
		<script src="../../js/auth.js"></script>
		<script src="../../js/wxShare.js"></script>
		
		<script type="text/javascript" charset="UTF-8">
			$('.mui-content').Auth();
			var loginUser = userInfo;
			var byId = function(id) {
				return document.getElementById(id);
			};
			var options = new Object();

			var cityPicker = new mui.PopPicker({
					layer: 2
				});
				
			initAgentInfo();
			initCityControl();

			$('#publishPosition').on('tap',function(){
				options.publishuserid = loginUser.id;
				options.usertype = loginUser.agentflag;
				
				var d = new Date();
				console.log("d is "+d);

				index = byId("expiretime").selectedIndex;
				var gap = parseInt(byId("expiretime").options[index].value);
				console.log("gap is "+gap);

				d.setMonth(d.getMonth() + gap);
				console.log("after mod, d is "+d);
				options.expiretime = d;
				options.expireinfo = gap;
				// options.expiretime = byId("expiretime").options[index].value;

				index = byId("recruitcount").selectedIndex;
				options.recruitcount = byId("recruitcount").options[index].value;

				index = byId("position").selectedIndex;
				options.recruitposition = byId("position").options[index].value;
				if(options.recruitposition == null || options.recruitposition == ' ')
				{
					mui.toast('请选择招聘职位');
					return;
				}

				options.recruitworkcity =  $("#showCityPicker").text();
				if(options.recruitworkcity == "请选择城市")
				{
					mui.toast('请选择城市');
					return;
				}
				
				options.location = byId("location").value;
				options.workperiod = byId("workingExperience").value;

				index = byId("education").selectedIndex;
				options.education = byId("education").options[index].value;

				index = byId("salary").selectedIndex;
				options.salary = byId("salary").options[index].value;
				
				var positionDesLen = getByteLen(byId("position_des").value.trim());
				var companyDesLen = getByteLen(byId("company_des").value.trim());
		    	//alert('positionDesLen:'+positionDesLen);
		    	if(positionDesLen < 10)
		    	{
		    		mui.toast("职位描述，至少5个字符");
				    return false;
		    	}
		    	if(companyDesLen < 10)
		    	{
		    		mui.toast("公司简介，至少5个字符");
				    return false;
		    	}
		    	
		    	if(positionDesLen > 500)
		    	{
		    		mui.toast("字符超长，限250汉字");
				    return false;
		    	}
		    	if(companyDesLen > 500)
		    	{
		    		mui.toast("字符超长，限250汉字");
				    return false;
		    	}
				
				options.positiondetail = byId("position_des").value;
				options.organizationinfo = byId("company_des").value;
				options.recruitsubject = "招聘"+options.recruitposition;
				
				var url = addRecruitUrl;
				$('#publishPosition').addClass('mui-disabled');
				$('#publishPosition').css('background-color','grey');
				ajax_to_server(url,options,addRecruitSuc,addRecruitFailed);
			});


			function initAgentInfo()
			{
				if(loginUser)
				{
					ajax_get_agent_detail(loginUser,getAgentDetailSuc,getAgentDetailFailed);
				}
				else{
					// mui.toast('没有获取到您的用户信息');
				}
			}
			
			function getAgentDetailSuc(data)
			{
				console.log("getAgentDetailSuc: data is "+JSON.stringify(data));
				options.organization = data.organization;
				if(!data.organization){
					mui.alert('对不起，请先在个人资料中完善所属公司信息后再重试！',null,null,function(){
						window.location.href='../../Agent/Mine/MyAgentSettingModify.html'
					})
				}
				options.position = data.position;
			}
			
			function getAgentDetailFailed(data)
			{
				console.log("getAgentDetailFailed");
			}
			
			function addRecruitSuc(data)
		    {
		    	console.log('data:'+JSON.stringify(data));
		    	if(!data || data.rscode !== 0)
				{
					mui.toast('发布职位失败:'+data.error);
					return;
				}
				
		    	toastMSG = '发布职位成功';
				
				var dstUrl = "../index.html";
				mui.toast(toastMSG);
				mui.openWindow({
					url: dstUrl
				});
				
		    }
		    
		    function addRecruitFailed(data)
		    {
		    	console.log('addRecruitFailed data:'+JSON.stringify(data));
		    	var toastMSG = '网络异常，提交失败，请重试！';
				mui.toast(toastMSG);
		    }
			
			function initCityControl()
			{
				//级联示例
				//cityPicker.setData(openedCityData);
				var data = cityData;
	
				for(var i in data)
				{
					if(data[i].text == '北京市' || data[i].text =='上海市' || data[i].text == '天津市' || data[i].text == '重庆市')
					{
						
						//data[i].children.splice(0,data[i].children.length);
						data[i].children.unshift({value: "000000",text: "不限"});
					}	
				}
				cityPicker.setData(data);
	
				//cityPicker.setData(cityData);
				
				var showCityPickerButton = document.getElementById('showCityPicker');
				
				showCityPickerButton.addEventListener('tap', function(event) {
					cityPicker.show(function(items) {	
						console.log("你选择的城市是:" + items[0].text+items[1].text);
						if(items[1].text == "不限")
						{
							showCityPickerButton.innerText = items[0].text;
						}
//						else if(items[1].text == "广州市" || items[1].text == "深圳市" || items[1].text == "杭州市")
//						{
//							showCityPickerButton.innerText = items[0].text;
//						}
						else
						{
							showCityPickerButton.innerText = items[0].text+items[1].text;
						}
						
					});
				}, false);
				
			}

		</script>
	</body>

</html>