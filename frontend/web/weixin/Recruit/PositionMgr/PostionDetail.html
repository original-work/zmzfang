<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="http://www.zmzfang.com/weixin/js/head.js"></script>
    	<title>芝麻找房</title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/style.css?v=0.02" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.css" />
        <link rel="stylesheet" type="text/css" href="../../css/mui.poppicker.css" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.css" />
        <link rel="stylesheet" type="text/css" href="../../css/mui.poppicker.css" />
		<style type="text/css">

		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">职位详情</h1>
			<button id="savePositionInfo" type="button" class="mui-btn" style="float:right;width: 15%;height: 30px;margin-top: 2px;background-color: #4cd964;color: #fff;">
			保存
			</button>
		</header>

		<div class="mui-content">
			<section id='requirement-info' class="requirement-info">
				<ul id="addressInfoList" class="mui-table-view">
					
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>职位</label>
							<select id="position" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='业务员'>业务员</option>
								<option value='置业顾问'>置业顾问</option>
								<option value='客户经理'>客户经理</option>
								<option value='店长'>店长</option>
								<option value='案场销售'>案场销售</option>
								<option value='客户主任'>客户主任</option>
								<option value='销售总监'>销售总监</option>
								<option value='行政管理'>行政管理</option>
								<option value='房产评估师'>房产评估师</option>
								<option value='客服'>客服</option>
								<option value='其他房产职位'>其他房产职位</option>
							</select>
						</div>
					</li>
					
					<li class="mui-table-view-cell">
						<div id="cityDiv" class="mui-input-row">
							<label>工作城市</label>
							<button id='showCityPicker' class="mui-btn mui-btn-block" type='button' style="margin-bottom: 10px;padding:10px 5px;float: left;width: 60%"></button>
						</div>
					</li>
					
			
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>具体地址</label>
							<input id="location" type="text" placeholder="">
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>招聘人数</label>
							<select id="recruitcount" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='1人'>1人</option>
								<option value='1-3人'>1-3人</option>
								<option value='3-5人'>3-5人</option>
								<option value='5-8人'>5-8人</option>
								<option value='8人以上'>8人以上</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>有效期</label>
							<select id="expiretime" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value=1>1个月</option>
								<option value=2>2个月</option>
								<option value=3>3个月</option>
								<option value=4>4个月</option>
								<option value=5>5个月</option>
								<option value=6>6个月</option>
								<option value=12>1年</option>
								<option value=360>常年有效</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>工作年限</label>
							<select id="workingExperience" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='不限'>不限</option>
								<option value='1-3'>1-3年</option>
								<option value='3-5'>3-5年</option>
								<option value='5-8'>5-8年</option>
								<option value='8-30'>8年以上</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>学历要求</label>
							<select id="education" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='不限'>不限</option>
								<option value='中专'>中专</option>
								<option value='高中'>高中</option>
								<option value='大专'>大专</option>
								<option value='本科'>本科</option>
								<option value='研究生及以上'>研究生及以上</option>
							</select>
						</div>
					</li>

					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>薪酬</label>
							<select id="salary" class="mui-btn mui-btn-block" style="float:left;width:50%">
								<option value='0-3000'>3k以下</option>
								<option value='3000-5000'>3k-5k</option>
								<option value='5000-8000'>5k-8k</option>
								<option value='8000-10000'>8k-10k</option>
								<option value='10000-15000'>10k-15k</option>
								<option value='15000-20000'>15k-20k</option>
								<option value='20000-25000'>20k以上</option>
								<option value='面议'>面议</option>
							</select>
						</div>
					</li>
				
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>职位描述</label>
							<textarea id="position_des" rows="5" placeholder="" ></textarea>
						</div>
					</li>
				
					<li class="mui-table-view-cell">
						<div class="mui-input-row">
							<label>公司介绍</label>
							<textarea id="company_des" rows="3" placeholder="" ></textarea>
						</div>
					</li>	
				</ul>
			</section>
	
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/jquery.min.js"></script>
		<script src="../../js/common.js"></script>
		<script src="../../js/ajax.js"></script>
		<script src="../../js/area.js"></script>
		<script src="../../js/city.data.js"></script>
		<script src="../../js/commonAjax.js"></script>
		<script src="../../js/mui.picker.js"></script>
		<script src="../../js/mui.poppicker.js"></script>
		<script src="../../js/wxShare.js"></script>
		
		<script type="text/javascript" charset="UTF-8">
			var byId = function(id) {
				return document.getElementById(id);
			};
			var cityPicker = new mui.PopPicker({
					layer: 2
				});
			initCityControl();
			var options = new Object();
			var recruitId = null;
			var createTime = null;
			var urlString = String(window.document.location.href);
			var data = localStorage.getItem('zmzfangLoginUserInfo');
			var user = JSON.parse(data);
			recruitId = getQueryStr("recruitid");
			options.recruitid = recruitId;
			options.publishuserid = user.id;

			ajax_get_recruit_detail(options,getRecruitDetailSuc,getRecruitDetailFailed);


			function getRecruitDetailSuc(data,flag)
			{
				console.log('getRecruitDetailSuc data='+JSON.stringify(data));
				initSelectElementByValue('position',data.position);
				byId("showCityPicker").innerText = data.recruitworkcity;

				byId("location").value = data.location;
				initSelectElementByValue('recruitcount',data.recruitcount);
				
				initSelectElementByValue('expiretime',data.expireinfo);
//				byId("expiretime").innerText = data.expiretime;
				initSelectElementByValue('workingExperience',data.workperiod);
				initSelectElementByValue('education',data.education);
//				
				initSelectElementByValue('salary',data.salary);

				byId("position_des").value = data.positiondetail;
				byId("company_des").value = data.organizationinfo;
				createTime = data.createtime;
			}

			function getRecruitDetailFailed(data,flag)
			{
				console.log('getRecruitDetailFailed');
			}

			function getQueryStr(str) {
				var rs = new RegExp("(^|)" + str + "=([^&]*)(&|$)", "gi").exec(urlString), tmp;
				if (tmp = rs) {
				return tmp[2];
				}
				// parameter cannot be found
				return "";
			}

			function initCityControl()
			{
				//级联示例
				var data = cityData;
	
				for(var i in data)
				{
					if(data[i].text == '北京市' || data[i].text =='上海市' || data[i].text == '天津市' || data[i].text == '重庆市')
					{
						data[i].children.unshift({value: "000000",text: "不限"});
					}	
				}
				cityPicker.setData(data);
				
				//cityPicker.setData(openedCityData);
				var showCityPickerButton = document.getElementById('showCityPicker');
				
				showCityPickerButton.addEventListener('tap', function(event) {
					cityPicker.show(function(items) {	
						console.log("你选择的城市是:" + items[0].text);
						//showCityPickerButton.innerText = items[0].text;
						if(items[1].text == "不限")
						{
							showCityPickerButton.innerText = items[0].text;
						}
						else
						{
							showCityPickerButton.innerText = items[0].text+items[1].text;
						}
					});
				}, false);
				
			}
			
			 //增加保存个人信息按钮事件
			document.querySelector('#savePositionInfo').addEventListener('tap', function() {
				console.log('savePositionInfo click');
                savePositionInfo();
			}, false);
			
			function savePositionInfo()
			{
				var data = {};
				data.recruitid = recruitId;
	
				data.recruitposition = getSelectElementValue('position');
				if(data.recruitposition == null || data.recruitposition == '')
				{
					mui.toast('招聘职位不能为空');
					return;
				}
				data.recruitsubject = '招聘'+data.recruitposition;
				data.recruitworkcity = byId("showCityPicker").innerText;
				data.location = byId("location").value;
				
				data.recruitcount = getSelectElementValue('recruitcount');
				
				var tmpTime = createTime;
				tmpTime = tmpTime.replace(/-/g,'/'); // 将-替换成/，因为下面这个构造函数只支持/分隔的日期字符串
				var d = new Date(tmpTime);
				//var d = new Date();
				
				index = byId("expiretime").selectedIndex;
				var gap = parseInt(getSelectElementValue('expiretime'));
				console.log("gap is "+gap);

				d.setMonth(d.getMonth() + gap);
				
				console.log("after mod, d is "+d);
				data.expiretime = d;
				data.expireinfo = gap;
				
		
				data.expireinfo = getSelectElementValue('expiretime');

				data.workperiod = getSelectElementValue('workingExperience');
				data.education = getSelectElementValue('education');
				
				data.salary = getSelectElementValue('salary');

				var positionDesLen = getByteLen(byId("position_des").value.trim());
				var companyDesLen = getByteLen(byId("company_des").value.trim());
		    	//alert('positionDesLen:'+positionDesLen);
		    	if(positionDesLen < 10)
		    	{
		    		mui.toast("职位描述，至少5个字符");
				    return false;
		    	}
		    	if(companyDesLen < 10)
		    	{
		    		mui.toast("公司简介，至少5个字符");
				    return false;
		    	}
		    	
		    	if(positionDesLen > 500)
		    	{
		    		mui.toast("字符超长，限250汉字");
				    return false;
		    	}
		    	if(companyDesLen > 500)
		    	{
		    		mui.toast("字符超长，限250汉字");
				    return false;
		    	}
		    	
				data.positiondetail = byId("position_des").value;
				data.organizationinfo = byId("company_des").value;
				
				
				
				console.log('data:'+JSON.stringify(data));
				var dstUrl = modifyRecruitUrl;
				ajax_to_server(dstUrl,data,modifyPositionInfoSuccess,modifyPositionInfoFailed);
			}
			
			function modifyPositionInfoSuccess(data)
			{
				console.log("modifyUserInfoSuccess data:"+JSON.stringify(data));
				if(data.rscode != 0)
				{
					mui.toast('修改职位信息失败:'+data.error);
					return;
				}
				toastMSG = '修改职位信息成功';
				mui.toast(toastMSG);
				
				mui.back();
			}
			
			function modifyPositionInfoFailed(data)
			{
				console.log("modifyPositionInfoFailed data:"+JSON.stringify(data));
				mui.toast('网络原因，修改信息失败');
			}
		</script>
	</body>

</html>